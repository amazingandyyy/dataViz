<!doctype html>

<html>

<head>
  <link rel="stylesheet" href="https://openlayers.org/en/v3.20.1/css/ol.css" type="text/css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.2.3/d3.min.js"></script>
  <script src="https://openlayers.org/en/v3.20.1/build/ol.js" type="text/javascript"></script>
  <style>
    circle {
      opacity: 0.5;
      fill: white;
    }
    svg {
      border: 1px solid black;
      background: black;
    }
  </style>
</head>

<body>
    
    <!--<div id="map" class="map"></div>-->
    <script type="text/javascript">
      var map = new ol.Map({
        target: 'map',
        layers: [
          new ol.layer.Tile({
            source: new ol.source.OSM()
          })
        ],
        view: new ol.View({
          center: ol.proj.fromLonLat([-122.41, 37.82]),
          zoom: 12
        })
      });
    </script>

  <script type="text/javascript">
    let outerWidth = 500;
    let outerHeight = 250;
    let rMin = 0;
    let rMax = 5;
    let xAxis = 'longitude';
    let yAxis = 'latitude';
    let rAxis = 'population';
    let colorAxis = 'name';
    const margin = {left: 30, right: 30, bottom: 30, top: 30};
    let svg = d3.select('body').append('svg')
      .attr('width', outerWidth)
      .attr('height', outerHeight);
    let g = svg.append('g').attr('transform', 'translate(0,30)');
    
    let xScale = d3.scaleLinear().range([0, outerWidth - margin.left - margin.right]);
    let yScale = d3.scaleLinear().range([outerHeight - margin.top - margin.bottom, 0]);
    let rScale = d3.scaleSqrt().range([rMin, rMax]);
    let colorScale = d3.scaleOrdinal(d3.schemeCategory10);
    console.log(d3.schemeCategory10)
  
    function render(data) {
  
      let circles = g.selectAll('circle').data(data)
  
      xScale.domain(d3.extent(data, d=>d[xAxis]));
      yScale.domain(d3.extent(data, d=>d[yAxis]));
      rScale.domain(d3.extent(data, d=>d[rAxis]));
      colorScale.domain(d3.extent(data, d=>d[colorAxis]));
  
      circles.exit().remove()
  
      circles.enter().append('circle')
        .merge(circles)
        .attr('r',  d => rScale(d.population))
        .attr('cx', d => xScale(d.longitude))
        .attr('cy', d => yScale(d.latitude))
  
    }
  
    function type(d) {
      d.latitude = +d.latitude;
      d.longitude = +d.longitude;
      d.population = +d.population;
      return d;
    }
  
    d3.csv('cities.csv', type, render);
      
  </script>
</body>

</html>